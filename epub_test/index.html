<html>
    <head>
        <script>
            function getData(callback) {
                var xhttp = new XMLHttpRequest()
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200 && this.responseText.length > 0) {
                        callback(this.responseText)
                    }
                }
                xhttp.open("GET", "part0005.html", true)
                xhttp.send()
            }
            function extractContents(data) {
                let parser = new DOMParser()
                let doc = parser.parseFromString(data, "text/html")
                let content = doc.querySelectorAll("body > *")// doc.body.childNodes // this is a HTMLCo

                for (var i = 0; i < content.length; i++) {
                    document.body.appendChild(content[i])
                }
                //console.log(countCharactersInDom(document.body))
                console.log(content[1])
                //console.log(findNodeForPosition(content[1], 1))
                var splc = split(content[1], 5)
                document.body.insertBefore(splc, content[1])
                console.log()
            }
            function countCharactersInDom(el) {
                // https://www.w3schools.com/jsref/prop_node_nodetype.asp
                if (el.nodeType == Node.TEXT_NODE) {
                    return el.nodeValue.length
                } else if (el.nodeType == Node.ELEMENT_NODE) {
                    var count = 0
                    var children = el.childNodes
                    for (var i = 0; i < children.length; i++) {
                        count = count + countCharactersInDom(children[i])
                    }
                    return count
                } else {
                    return 0
                }
            }
            // split a node into two nodes, based on a character count
            // go through the node recursively, find the position where the split should be made
            // https://stackoverflow.com/questions/7237865/splitting-node-content-in-javascript-dom
            function split(node, chars) {
                var range = document.createRange()
                range.setStart(node, 0)
                range.setEnd(findNodeForPosition(node, chars), chars)
                var c = range.extractContents()
                return c
            }
            function findNodeForPosition(el, position) {
                if (el.nodeType == Node.TEXT_NODE) {
                    if (el.nodeValue.length >= position) {
                        return el
                    } else {
                        return null
                    }
                } else if (el.nodeType == Node.ELEMENT_NODE) {
                    var children = el.childNodes
                    var remainingPosition = position
                    for (var i = 0; i < children.length; i++) {
                        var node = findNodeForPosition(children[i], remainingPosition)
                        if (node != null) {
                            return node
                        } else {
                            remainingPosition = remainingPosition - countCharactersInDom(children[i])
                        }
                    }
                }
                return null
            }
            /*function splitNode(node, offset, limit) {
                var parent = limit.parentNode;
                var parentOffset = getNodeIndex(parent, limit);

                var doc = node.ownerDocument;
                var leftRange = doc.createRange();
                leftRange.setStart(parent, parentOffset);
                leftRange.setEnd(node, offset);
                var left = leftRange.extractContents();
                parent.insertBefore(left, limit);
            }
            function getNodeIndex(parent, node) {
                var index = parent.childNodes.length;
                while (index--) {
                    if (node === parent.childNodes[index]) {
                        break;
                    }
                }
                return index;
            }*/
        </script>
    </head>
    <body>
        <script>
            getData(extractContents)
        </script>
    </body>
</html>