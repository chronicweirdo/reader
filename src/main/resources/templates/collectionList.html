<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <div th:replace="fragments/headFragment :: normalPage"></div>

    <title>Collections - Chronic Reader</title>

    <link rel="stylesheet" type="text/css" href="fonts.css">
    <link rel="stylesheet" type="text/css" href="more.css">
    <script src="settings.js"></script>
    <script src="util.js"></script>
    <script>
        var EXPAND_CLASS = "expand"
        var EXPAND_HTML = "+"
        var COLLAPSE_HTML = "-"
        var EXPAND_TITLE = "expand"
        var COLLAPSE_TITLE = "collapse"

        function toggle(el) {
            var current = el
            while (current && current.tagName != "LI") current = current.parentElement
            var target = current.getElementsByTagName("UL")[0]
            if (target) {
                if (target.style.display != "none") {
                    target.style.display = "none"
                    let sign = target.previousElementSibling
                    if (sign && sign.classList.contains(EXPAND_CLASS)) {
                        sign.innerHTML = EXPAND_HTML
                        sign.title = EXPAND_TITLE
                    }
                } else {
                    target.style.display = "block"
                    let sign = target.previousElementSibling
                    if (sign && sign.classList.contains(EXPAND_CLASS)) {
                        sign.innerHTML = COLLAPSE_HTML
                        sign.title = COLLAPSE_TITLE
                    }
                }
            }
        }

        function addExpandSymbol(item) {
            var link = item.getElementsByTagName("A")[0]
            var expand = document.createElement("span")
            expand.classList.add(EXPAND_CLASS)
            expand.innerHTML = EXPAND_HTML
            expand.title = EXPAND_TITLE
            expand.addEventListener("click", (event) => {
                event.stopPropagation()
                toggle(event.target)
            })
            link.after(expand)
        }

        function getLiWithChildren() {
            var items = document.getElementsByTagName("LI")
            var result = []
            for (var i = 0; i < items.length; i++) {
                if (items[i].getElementsByTagName("UL").length > 0) {
                    result.push(items[i])
                }
            }
            return result
        }

        window.onload = function() {
            configureTheme(true)
            var expandable = getLiWithChildren()
            for (var i = 0; i < expandable.length; i++) {
                addExpandSymbol(expandable[i])
                toggle(expandable[i])
            }
        }
    </script>
</head>
<body>
<h1>A list of collections, so you know what to choose</h1>
<p><a th:href="@{/(search=${tree.search})}" th:text="${tree.name}">collection name</a></p>
<div th:fragment="fragment_node" th:remove="tag">
    <ul class="tree" th:if="${not #lists.isEmpty(tree.children)}" >
        <li th:each="child : ${tree.children}"
            th:inline="text"
            th:with="tree = ${child}">
            <a th:href="@{/(search=${child.search})}" th:text="${child.name}">collection name</a>
            <ul th:replace="this::fragment_node">List Item</ul>
        </li>
    </ul>
</div>
</body>
</html>