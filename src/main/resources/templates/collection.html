<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Comics Reader</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            border: 0;
        }
        h1 {
            margin: .5vw;
        }
        .imgdiv {
            position: relative;
            display: inline-block;
            width: 9vw;
            height: 15vw;
            overflow: hidden;
            text-decoration: none;
            margin: .5vw;
        }
        .imgdiv.selected {
            width: 8.6vw;
            height: 14.6vw;
            border: .2vw solid red;
        }
        @media	only screen and (-webkit-min-device-pixel-ratio: 1.3),
        only screen and (-o-min-device-pixel-ratio: 13/10),
        only screen and (min-resolution: 120dpi)
        {
            .imgdiv {
                width: 22vw;
                height: 37vw;
                margin: 1vw;
            }
            .imgdiv.selected {
                width: 21vw;
                height: 36vw;
                border: .5vw solid red;
            }
        }
        .imgdiv img {
            position: relative;
        }
        .imgdiv .pagenum {
            position: absolute;
            right: 10px;
            bottom: 10px;
            background-color: white;
            padding: .5em;
            font-size: 1.2em;
            font-weight: bold;
            color: black;
        }
        .imgdiv .progressbar {
            position: absolute;
            display: block;
            left: 4%;
            bottom: 4%;
            width: 88%;
            height: 4%;
            background-color: white;
            border: 1px solid black;
            padding: 1%;
        }
        .imgdiv .progressbar .read {
            display: block;
            background-color: black;
            height: 100%;
        }
        .latestRead {
            border-bottom: 2px solid black;
        }
    </style>
    <script src="hammer.min.js"></script>
    <script>
        function addPagenum(image, page, totalPages) {
            var span = document.createElement("span")
            span.innerText = page + " / " + totalPages
            span.classList.add("pagenum")
            image.parentElement.appendChild(span)
        }
        function addProgress(image, page, totalPages) {
            var span = document.createElement("span")
            span.classList.add("progressbar")
            span.title = "read " + page + " of " + totalPages + " pages"
            var prog = document.createElement("span")
            prog.classList.add("read")
            prog.style.width = (page / totalPages * 100) + "%"
            span.appendChild(prog)
            image.parentElement.appendChild(span)
        }
        function scaleImage(image, page, totalPages) {
            if (page >= 0) {
                //addPagenum(image, page, totalPages)
                addProgress(image, page, totalPages)
            }
            var imageContainer = document.getElementsByClassName("imgdiv")[0]
            var expectedHeight = imageContainer.offsetHeight
            var expectedWidth = imageContainer.offsetWidth
            if (image.naturalWidth / image.naturalHeight > expectedWidth / expectedHeight) {
                image.style.height = "100%"
            } else {
                image.style.width = "100%"
            }
            var differenceWidth = image.offsetWidth - expectedWidth
            var differenceHeight = image.offsetHeight - expectedHeight
            image.style.left = (- differenceWidth / 2) + "px"
            image.style.top = (- differenceHeight / 2) + "px"

            enableTouchGestures(image)
            image.addEventListener('contextmenu', function(ev) {
                ev.preventDefault();
                select(image)
            }, false);
        }
        function enableTouchGestures(element) {
            //disableEventHandlers(element)
            var hammertime = new Hammer(element, {
                domEvents: true
                });

            hammertime.on('press', function(ev) {
                console.log("pressed")
            });
        }
        function select(image) {
            image.parentElement.classList.add("selected")
        }
    </script>
</head>
<body>
<p th:text="${user}">user name</p>
<p><a href="/logout">logout</a></p>
<div class="latestRead" th:unless="${#lists.isEmpty(latestRead)}">
    <h1>Latest Read</h1>
    <p><a class="imgdiv" th:each="comic: ${latestRead}" th:href="'comic?id=' + ${comic.id}">
        <img th:attr="onload='scaleImage(this,' + ${comic.progress} + ',' + ${comic.pages} + ')'" th:src="${comic.cover}" th:title="${comic.title}">
    </a></p>
</div>
<div th:each="collection: ${comicCollections}">
    <h1 th:text="${collection.name}">Collection Name</h1>
    <p>
        <a class="imgdiv" th:each="comic: ${collection.comics}" th:href="'comic?id=' + ${comic.id}">
            <img th:attr="onload='scaleImage(this,' + ${comic.progress} + ',' + ${comic.pages} + ')'" th:src="${comic.cover}" th:title="${comic.title}">
        </a></p>
</div>
</body>
</html>